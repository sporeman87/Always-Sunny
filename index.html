<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Minimal Weather Forecast</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: 2rem auto; padding: 1rem; }
  input, button { padding: 0.5rem; font-size: 1rem; }
  #forecast { margin-top: 1rem; }
</style>
</head>
<body>

<h1>Weather Forecast</h1>

<label for="locationInput">Enter City or Zip:</label><br />
<input id="locationInput" type="text" placeholder="e.g. Boston or 02108" />
<button id="fetchBtn">Get Forecast</button>

<h2 id="locationName"></h2>
<div id="forecast"></div>

<script>
  const geoApiKey = '87e825738a584b12ba7f1127533efafd'; // Your Geoapify API key

  async function geocode(query) {
    const url = `https://api.geoapify.com/v1/geocode/search?text=${encodeURIComponent(query)}&limit=1&apiKey=${geoApiKey}`;
    const res = await fetch(url);
    if (!res.ok) throw new Error('Geocoding API error');
    const data = await res.json();
    if (!data.features || data.features.length === 0) throw new Error('Location not found');
    const feature = data.features[0];
    return {
      lat: feature.geometry.coordinates[1],
      lon: feature.geometry.coordinates[0],
      name: feature.properties.formatted
    };
  }

  async function fetchWeather(lat, lon) {
    const dailyParams = "moon_phase,temperature_2m_max,temperature_2m_min,weathercode,windspeed_10m_max";
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=${dailyParams}&temperature_unit=fahrenheit&timezone=auto`;

    const res = await fetch(url);
    if (!res.ok) throw new Error('Weather API error');
    const data = await res.json();
    if (!data.daily) throw new Error("Missing 'daily' data in API response.");
    return data.daily;
  }

  function weatherCodeToText(code) {
    const map = {
      0: "Clear sky",
      1: "Mainly clear",
      2: "Partly cloudy",
      3: "Overcast",
      45: "Fog",
      48: "Depositing rime fog",
      51: "Light drizzle",
      53: "Moderate drizzle",
      55: "Dense drizzle",
      56: "Light freezing drizzle",
      57: "Dense freezing drizzle",
      61: "Slight rain",
      63: "Moderate rain",
      65: "Heavy rain",
      66: "Light freezing rain",
      67: "Heavy freezing rain",
      71: "Slight snow fall",
      73: "Moderate snow fall",
      75: "Heavy snow fall",
      77: "Snow grains",
      80: "Slight rain showers",
      81: "Moderate rain showers",
      82: "Violent rain showers",
      85: "Slight snow showers",
      86: "Heavy snow showers",
      95: "Thunderstorm",
      96: "Thunderstorm with slight hail",
      99: "Thunderstorm with heavy hail"
    };
    return map[code] || "Unknown";
  }

  function moonPhaseToText(value) {
    if (value === null || value === undefined) return "Unknown";
    if (value === 0 || value === 1) return "New Moon";
    if (value < 0.25) return "Waxing Crescent";
    if (value === 0.25) return "First Quarter";
    if (value < 0.5) return "Waxing Gibbous";
    if (value === 0.5) return "Full Moon";
    if (value < 0.75) return "Waning Gibbous";
    if (value === 0.75) return "Last Quarter";
    return "Waning Crescent";
  }

  document.getElementById('fetchBtn').addEventListener('click', async () => {
    const query = document.getElementById('locationInput').value.trim();
    if (!query) {
      alert('Please enter a city or zip code.');
      return;
    }
    try {
      document.getElementById('locationName').textContent = "Loading...";
      document.getElementById('forecast').textContent = "";

      const loc = await geocode(query);
      document.getElementById('locationName').textContent = loc.name;

      const daily = await fetchWeather(loc.lat, loc.lon);

      const date = daily.time[0];
      const maxTemp = daily.temperature_2m_max[0];
      const minTemp = daily.temperature_2m_min[0];
      const weatherText = weatherCodeToText(daily.weathercode[0]);
      const windMax = daily.windspeed_10m_max[0];
      const moonPhase = moonPhaseToText(daily.moon_phase[0]);

      document.getElementById('forecast').innerHTML = `
        <strong>Date:</strong> ${date}<br />
        <strong>Max Temp:</strong> ${maxTemp} °F<br />
        <strong>Min Temp:</strong> ${minTemp} °F<br />
        <strong>Weather:</strong> ${weatherText}<br />
        <strong>Max Wind Speed:</strong> ${windMax} km/h<br />
        <strong>Moon Phase:</strong> ${moonPhase}
      `;
    } catch (err) {
      console.error(err);
      alert('Error fetching weather: ' + err.message);
      document.getElementById('locationName').textContent = "";
      document.getElementById('forecast').textContent = "";
    }
  });
</script>

</body>
</html>
